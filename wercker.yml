# Docker Hubのコンテナを指定。
# https://hub.docker.com/←ここからコンテナを検索してwerckerからデプロイする際に必要な環境を満たしたコンテナをboxをとして指定します。
# 今回はsshコマンドしか使用しないので、sshのみインストールされているコンテナを指定しています。
box: dock0/ssh

# ビルドフェーズ。ここでwerckerの環境を構築します。
build:
  steps:
    - script:
        name: echo
        code: |
          echo "Build Step"

# デプロイフェーズ。ここでさくらサーバにデプロイします。
deploy:
  steps:
    # 一時的に使用するフォルダを作成
    - mktemp:
        envvar: PRIVATEKEY_PATH
        
    # 作成したフォルダに4.で指定したSSHキーが記述されたファイルを作成
    - create-file:
        name: write key
        filename: $PRIVATEKEY_PATH
        
        # $[4.の「Environment variable」で入力した値]_PRIVATE
        content: $DEPLOY_KEY_WERCEKR
        overwrite: true
        hide-from-log: true

    # コマンドを実行。今回はsshでデプロイ先に接続し、git pullしています。
    - script:
        name: transfer application
        code: |
          ssh -p 22 -i $PRIVATEKEY_PATH -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null wercker@52.69.111.103 "cd [/var/www/html/test] && git pull origin master"
